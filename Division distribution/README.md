# Calculating the distribution of divisions before extinction

This script calculates the probability that clone ![equation](https://latex.codecogs.com/svg.latex?i) will divide ![equation](https://latex.codecogs.com/svg.latex?k) times before going extinct for all starting states in ![equation](https://latex.codecogs.com/svg.latex?%5Cmathcal%7BA%7D%5E%7B0%7D) using first step analysis, denoted ![equation](https://latex.codecogs.com/svg.latex?%5Cmathcal%7BD%7D_%7Bi%2Ck%7D).

The birth and death rates are calculated using a matrix of self-pMHC sharing probabilities, for which values are sampled using Latin Hypercube Sampling, assuming that the probabilities are uniformly distributed.

The transition matrix for the Markov process conditioned on no division of clonotype ![equation](https://latex.codecogs.com/svg.latex?i) is calculated, ![equation](https://latex.codecogs.com/svg.latex?%5Cmathbf%7BP%7D%5E%7B%28i%29%7D), and the inverse of it's associated matrix, ![equation](https://latex.codecogs.com/svg.latex?%5Cleft%28%5Cmathbf%7BW%7D%5E%7B%28i%29%7D%20%5Cright%29%5E%7B-1%7D%3D%5Cmathbf%7BI%7D-%5Cmathbf%7BP%7D%5E%7B%28i%29%7D), is calculated using the previous calculation.

The vector of probabilities of clone ![equation](https://latex.codecogs.com/svg.latex?i) dividing 0 times before extinction, denoted ![equation](https://latex.codecogs.com/svg.latex?%5Cmathbf%7Bd%7D%5E%7B%28i%29%7D_%7B0%7D), is calculated and the matrix equation ![equation](https://latex.codecogs.com/svg.latex?%5Cleft%28%5Cmathbf%7BI%7D-%5Cmathbf%7BP%7D%5E%7B%28i%29%7D%5Cright%29%5Cmathcal%7BD%7D_%7Bi%2C0%7D%3D%5Cmathbf%7Bd%7D%5E%7B%28i%29%7D_%7B0%7D) is solved for ![equation](https://latex.codecogs.com/svg.latex?%5Cmathcal%7BD%7D_%7Bi%2C0%7D) using the tri-diagonal by block structure of ![equation](https://latex.codecogs.com/svg.latex?%5Cmathbf%7BI%7D-%5Cmathbf%7BP%7D%5E%7B%28i%29%7D). The vector ![equation](https://latex.codecogs.com/svg.latex?%5Cleft%28%5Cmathbf%7Bd%7D%5E%7B%28i%29%7D_%7B%5Cell%7D%5Cright%29_%7B%5Ctextrm%7Bpos%7D_%7BS%2Ck%7D%28n%2C%5Ceta%29%7D%3Dp_%7Bnn%5E%7B%28&plus;i%29%7D%7D%5Cmathcal%7BD%7D_%7Bi%2C%5Cell-1%7D) is calculated, and the matrix equation ![equation](https://latex.codecogs.com/svg.latex?%5Cleft%28%5Cmathbf%7BI%7D-%5Cmathbf%7BP%7D%5E%7B%28i%29%7D%5Cright%29%5Cmathcal%7BD%7D_%7Bi%2C%5Cell%7D%3D%5Cmathbf%7Bd%7D%5E%7B%28i%29%7D_%7B%5Cell%7D) is solved for ![equation](https://latex.codecogs.com/svg.latex?%5Cmathcal%7BD%7D_%7Bi%2C%5Cell%7D) recursively. 

When running this script include `Samples.bin` in the same directory, and replace `SampleHolder` with the desired sample number for which the division distribution is to be calculated.